# 1 데이터 모델링

## 1.1 데이터 모델링 이해

- 모델링의 특징
  - 추상화: 다양한 현상을 일정한 양식인 표기법에 의해 표현한다.
  - 단순화: 복잡한 현실세계를 쉽게 이해할 수 있도록 한다.
  - 명확화: 대상에 대한 애매모호함을 제거하고 정확하게 현상을 기술한다.




- 모델링의 세 가지 관점
  - 데이터 관점: 어떤 데이터와 관련 있는지 또는 데이터간의 관계는 무엇인지
  - 프로세스 관점: 실제 하고 있는 일은 무엇인지 또는 무엇을 해야 하는지
  - 데이터와 프로세스의 상관 관점: 처리하는 방법에 따라 데이터가 어떻게 영향을 받는지




- 데이터 모델링의 정의
  - 데이터 관점의 업무 분석
  - 현실세계의 데이터를 약속된 표기법으로 표현
  - 데이터베이스를 구축하기 위한 분석/설계




- 데이터 모델이 제공하는 기능
  - 가시화
  - 명세화
  - 구조화된 틀
  - 문서화
  - 집중하기 위해 세부사항 숨기기
  - 구체화된 상세 수준의 표현방법



- 데이터 모델링의 중요성 및 유의점
  - 파급효과(Leverage): 후반부로 갈수록 변경으로 인한 비용손실과 납기지연 가능성이 커진다. 따라서 다른 어떤 설계 과정보다 데이터 설계가 더 중요하다.
  - 복잡한 정보 요구사항의 간결한 표현(Conciseness): 설계 도면. 많은 관련자들이 참고한다.
  - 데이터 품질(Data Quality)
    - 중복(Duplication): 일관성을 깨뜨릴 확률 높임
    - 비유연성(Inflexibility): 작은 변화에 민감하면 유지보수 어려움
    - 비일관성(Inconsistency): 데이터간 상호 연관 관계를 명확히 정의하는 것이 필요 (Trigger 등)



- 데이터 모델링의 3단계
  - 개념적 데이터 모델링: 추상화 수준이 높고 업무중심의 포괄적인 모델링. 전사적 데이터 모델링. EA 수립시 이용.
  - 논리적 데이터 모델링: 업무의 Key, 속성, 관계를 정확히 표현. 정규화. 재사용성 높음.
  - 물리적 데이터 모델링: 실제 데이터베이스에 이식하기 위한 모델링




- 프로젝트 생명주기
  | 단계      | 데이터                  | 프로세스        |
  | --------- | ----------------------- | --------------- |
  | 전환/이행 | DB 전환                 | AP 설치         |
  | 테스트    | DB 튜닝                 | AP 테스트       |
  | 개발      | DB 구축, 변경, 관리     | AP 개발         |
  | 설계      | 물리 데이터 모델링      | AP 설계         |
  | 분석      | 개념/논리 데이터 모델링 | 프로세스 모델링 |

  지속적으로 상호 검증 수행하면서 완성도를 높인다.



- 데이터 독립성 확보
  - 각 View의 독립성을 유지하고 계층별 View에 영향을 주지 않고 변경이 가능하다.
  - 단계별 Schema에 따라 데이터 정의어(DDL)와 데이터 조직어(DML)가 다름을 제공한다.



- 데이터베이스 3단계 구조
  - 외부 단계: View 단계. 사용자 관점
    - 논리적 데이터 독립성: 개념 스키마가 변경되어도 외부 스키마에 영향을 주지 않음.
  - 개념적 단계: 조직 전체 통합 관점
    - 물리적 데이터 독립성: 내부 스키마가 변경되어도 외부/개념 스키마에 영향을 주지 않음.
  - 내부적 단계: 물리적 저장구조



- 데이터 모델링의 세 가지 요소
  - 업무가 관여하는 어떤 것(Things: Entity, Instance)
  - 업무가 관여하는 어떤 것 간의 관계(Relationships)
  - 어떤 것이 가지는 성격(Attributes)



- 데이터 모델링의 이해관계자
  - 프로젝트 개발자
  - DBA
  - Architecture
  - 현업 전문가



- ERD
  - Peter Chen의 Entity-relationship model(E-R model) 표기법
  - IE/Crow's Foot 표기법
  - ERD(Entity Realtionship Diagram): 각 업무분석에서 도출된 엔터티와 엔터티간의 관계를 이해하기 쉽게 도식화된 다이어그램으로 표시



- 좋은 데이터 모델의 요소
  - 완전성(Completeness): 업무에서 필요로 하는 모든 데이터가 데이터 모델에 정의
  - 중복배제(Non-Redundancy): 하나의 데이터베이스 내에 동일한 사실은 반드시 한 번만 기록
  - 업무규칙(Business Rules): 업무규칙은 데이터 모델에 표현하고 모든 사용자가 공유
  - 데이터 재사용(Data Reusability): 데이터의 통합성과 독립성 고려. 즉, 행위 주체가 되는/행위 대상이 되는/행위 자체에 대한 통합 모델이어야 하며 애플리케이션에 대해 독립적이어야 한다.
  - 의사소통(Communication): 업무 규칙들은 데이터 모델에 엔터티, 서브타입, 속성, 관계 등의 형태로 최대한 자세하게 표현되어야 한다.
  - 통합성(Integration): 동일한 데이터는 조직 전체에서 가급적 한 번만 정의되고 이를 참조하도록 한다.





## 02 엔터티 (Entity)

업무에 필요하고 유용한 정보를 저장하고 관리하기 위한 집합적인 것(Thing)

- 엔터티의 개념
  - 변별 가능한 사물
  - 데이터베이스 내에서 변별 가능한 객체
  - 정보를 저장할 수 있는 것
  - 정보가 저장될 수 있는 사람, 장소, 물건, 사건, 개념 등

  - 공통점
    - 엔터티는 사람, 장소, 물건, 사건, 개념 등의 명사에 해당한다.
    - 엔터티는 업무상 관리가 필요한 관심사에 해당한다.
    - 엔터티는 저장이 되기 위한 어떤 것(Thing)이다.



- 엔터티의 특징
  - 업무에서 필요로 하는 정보
  - 식별이 가능해야 함 (식별자에 의해)
  - 인스턴스의 집합 (= 두 개 이상)
  - 업무프로세스에 의해 이용
  - 속성을 포함
  - 관계의 존재 (최소 한 개 이상)
    - 단 통계성 엔터티, 코드성 엔터티, 시스템 처리시 내부 필요에 의한 엔터티는 관계가 생략된다.



- 엔터티의 분류
  - 유무형에 따른 분류
    - 유형 엔터티(Tangible Entity): 물리적 형태가 있다.
      - e.g. 사원, 물품, 강사
    - 개념 엔터티(Conceptual Entity): 물리적 형태가 없다.
      - e.g. 조직, 보험상품
    - 사건 엔터티(Event Entity): 업무를 수행함에 따라 발생한다.
      - e.g. 주문, 청구, 미납
  - 발생시점에 따른 분류
    - 기본 엔터티(Fundamental Entity): 업무에 원래 존재하는 정보로 독립적으로 생성 가능하다. 타 엔터티의 부모 역할을 맡으며 자신의 고유한 주 식별자 소유한다. 
      - e.g. 사원, 부서, 고객, 상품, 자재
    - 중심 엔터티(Main Entity): 기본 엔터티로부터 발생되고 업무의 중심적인 역할을 한다. 데이터 양이 많이 발생한다. 다른 엔터티와의 관계를 통해 행위 엔터티를 생성한다.
      - e.g. 계약, 사고, 예금원장, 청구, 주문, 매출
    - 행위 엔터티(Active Entity): 두 개 이상의 부모 엔터티로부터 발생한다. 자주 내용이 수정되거나 데이터 양이 증가한다. 상세 설계단계 또는 프로세스와 상관모델링을 할 때 도출될 수 있다.
      - e.g. 주문목록, 사원변경이력



- 엔터티의 명명
  - 현업업무에서 사용하는 용어
  - 가능하면 약어를 사용하지 않는다.
  - 단수명사를 사용한다.
  - 모든 엔터티에서 유일하게 이름이 부여되어야 한다.
  - 생성의미대로 이름을 부여한다.





## 03 속성 (Attribute)

업무에서 필요로 하는 인스턴스로 관리하고자 하는 의미상 더 이상 분리되지 않는 최소의 데이터 단위

- 엔터티, 인스턴스, 속성, 속성값의 관계

  - 한 개의 엔터티는 두 개 이상의 인스턴스의 집합이어야 한다.
  - 한 개의 엔터티는 두 개 이상의 속성을 갖는다.
  - 한 개의 속성은 한 시점에 한 개의 속성을 갖는다.




- 속성의 특징

  - 반드시 해당 업무에서 필요하고 관리하고자 하는 정보이어야 한다.
  - 정규화 이론에 근간하여 정해진 주식별자에 함수적 종속성을 가져야 한다.
  - 하나의 속성에는 한 개의 값만을 가진다. 하나의 속성에 여러 개의 값이 있는 다중값일 경우 별도의 엔터티를 이용하여 분리한다.




- 속성의 분류
  - 속성의 특성에 따른 분류
    - 기본 속성(Basic Attribute): 업무로부터 추출한 모든 속성
    - 설계 속성(Designed Attribute): 유도 속성이라고도 한다. 데이터 모델링을 위해, 업무를 규칙화하기 위해 속성을 새로 만들거나 변형하여 정의한 속성
    - 파생 속성(Derived Attribute): 다른 속성에 영향을 받아 발생하는 속성
  - 엔터티 구성방식에 따른 분류
    - 슈퍼키(Super Key): 식별, key, key 조합
    - 후보키: 식별, 최소성
    - 기본키(Primary Key): 후보키 중 선택. 인덱스를 자동으로 생성한다.
    - 대체키: 후보키 중 선택되지 않은 나머지 키
    - 외래키(Foriegn Key)
    - 일반 속성: Key가 아닌 속성




- 도메인

  각 속성이 가질 수 있는 값의 범위

  즉, 엔터티 내에서 속성에 대한 데이터타입과 크기 그리고 제약사항을 지정하는 것



- 속성의 명령

  - 해당 업무에서 사용하는 이름을 부여한다.
  - 서술식 속성명은 사용하지 않는다.
  - 약어사용은 가급적 제한한다.
  - 전체 데이터 모델에서 유일성을 확보한다.





## 04 관계 (Relationship)

인스턴스 사이의 논리적인 연관성으로서 존재 또는 행위로서 서로에게 연광성이 부여된 상태

- 관계의 패어링
  - 엔터티 안의 인스턴스가 개별적으로 관계를 가지는 것은 패어링이라 한다.
  - 패어링의 집합을 관계로 표현한다.




- 관계의 분류

  - 존재에 의한 관계 (연관관계)
  - 행위에 의한 관계 (의존관계)




- 관계의 표기법
  - 관계명(Membership): 엔터티가 관계에 참여하는 형태

    - 관계는 두 개의 관계명을 갖는다. (양방향)
    - 명명규칙: 애매한 동사를 피하고 현재형으로 표현한다.

  - 관계차수(Degree/Cardinality): Crow's Foot
    - 1:1 (ONE TO ONE)

      (사짐)

    - 1:M (ONE TO MANY)

      (사진)

    - M:M (MANY TO MANY)

      (사진)

  - 관계선택사양(Optionality)

    - 필수 참여(Mandatory Membership): 모든 참여자가 반드시 관계를 가진다. 타 엔터티의 참여자와 연결된다.
    - 선택 참여(Optional Membership): Foreign Key로 연결될 경우 Null이 허용된다. ERD에서는 선택참여하는 엔터티 쪽을 원으로 표시한다.




- 관계의 정의 및 읽는 방법
  - 관계의 체크사항
    - 두 개의 엔터티 사이에 관심있는 연관규칙이 존재하는가?
    - 두 개의 엔터티 사이에 정보의 조합이 발생되는가?
    - 업무기술서, 장표에 관계연결에 대한 규칙이 서술되어 있는가?
    - 업무기술서, 장표에 관계연결을 가능하게 하는 동사(Verb)가 있는가? 
  - 관계 읽기
    - 기준(Source) 엔터티를 한 개(One) 또는 각(Each)으로 읽는다.
    - 대상(Target) 엔터티의 관계참여도 즉 개수(하나, 하나 이상)를 읽는다.
    - 관계선택사양과 관계명을 읽는다.





## 05 식별자

엔터티 내에서 인스턴스들을 구분할 수 있는 구분자

- 식별자의 특징
  - 유일성: 주식별자에 의해 엔터티 내에 모든 인스턴스들을 유일하게 구분함
  - 최소성: 주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 함
  - 불변성: 주식별자가 한 번 특정 엔터티에 지정되면 그 식별자의 값을 변하지 않아야 함
  - 존재성: 주식별자가 지정되면 반드시 데이터 값이 존재해야 함 


- 식별자 분류

  - 대표성 여부

    - 주식별자(Primary Identifier): 엔터티 내에서 각 어커런스를 구분할 수 있는 구분자이며, 타 엔터티와 참조관계를 연결할 수 있는 식별자
    - 보조식별자(Alternate Identifier): 엔터티 내에서 각 어커런스를 구분할 수 있는 구분자이나 대표성을 가지지 못해 참조관계 연결을 못함

  - 스스로 생성 여부

    - 내부식별자(International Identifier): 엔터티 내부에서 스스로 만들어지는 식별자
    - 외부식별자(Foreign Identifier): 타 엔터티와의 관계를 통해 타 엔터티로부터 받아오는 식별자

  - 속성의 수

    - 단일식별자(Single Identifier): 하나의 속성으로 구성된 식별자

    - 복합식별자(Composite Identifier): 둘 이상의 속성으로 구성된 식별자

      약 엔터티. PK는 하나인 것이 가장 좋다. 인덱스를 생성할 때 첫번째 식별자만 사용. 복합일 경우 문제 발생 가능

  - 대체 여부

    - 본질식별자: 업무에 의해 만들어지는 식별자
    - 인조식별자: 업무적으로 만들어지지는 않지만 원조식별자가 복잡한 구성을 가지고 있기 때문에 인위적으로 만든 식별자




- 주식별자 도출기준
  - 해당 업무에서 자주 이용
  - 명칭이나 내역과 같이 이름으로 기술되는 것은 부적절 (보통 일련번호, 코드 등으로 대체)
  - 속성 수 적게



- 식별자 관계와 비식별자 관계에 따른 식별자

  외부식별자(Foreign Identifier)는 자기 자신의 엔터티에서 필요한 속성이 아니라 다른 엔터티와의 관계를 통해 자식 쪽에 엔터티에 생성되는 속성을 외부식별자라 하며 데이터베이스 생성 시에 Foreign Key 역할을 한다.

  - 식별자 관계(Identifying Relationship)

    자식 엔터티의 주식별자로 부모의 주식별자가 상속이 되는 경우를 식별자 관계라고 지칭한다.

    부모로부터 받은 식별자를 자식 엔터티의 주식별자로 이용하는 경우는 Null 값이 오면 안되므로 반드시 부모 엔터티가 생성되어야 자기 자신의 엔터티가 생성되는 경우이다.

  - 비식별자 관계(Non-Identifying Relationship)

    - 부모 엔터티로부터 속성을 받았지만 자식 엔터티의 주식별자로 사용하지 않고 일반적인 속성으로만 사용하는 경우를 비식별자 관계라 한다.
    - 다음 네 가지 경우에 비식별자 관계에 의한 외부속성을 생성한다.
      - 자식 엔터티에서 받은 속성이 반드시 필수가 아니어도 무방하기 때문에 부모 없는 자식이 생성될 수 있는 경우
      - 엔터티별로 데이터의 생명주기를 다르게 관리할 경우. 예를 들어, 부모 엔터티의 인스턴스가 자식 엔터티와 관계를 가지고 있었지만 자식만 남겨두고 먼저 소멸될 수 있는 경우가 해당된다.
      - 여러 개의 엔터티가 하나의 엔터티로 통합되어 표현되었는데 각각의 엔터티가 별도의 관계를 가질 경우
      - 자식 엔터티에 주식별자로 사용하여도 되지만 자식 엔터티에서 별도의 주식별자를 생성하는 것이 더 유리하다고 판단될 경우

  - 식별자 관계로만 설정할 경우의 문제점

    지속적으로 식별자 관계를 연결한 데이터 모델의 PK 속성의 수는 데이터 모델의 흐름이 길어질수록 증가할 수 밖에 없는 구조를 가진다.

  - 비식별자 관계로만 설정할 경우의 문제점

    기준속성이 자식 엔터티로 상속되지 않아 데이터 조회가 어렵다. 부모 엔터티까지 찾아가야 한다. 따라서 불필요한 조인이 발생할 수 있다.



- 식별자 관계와 비식별자 관계 모델링

  - 비식별자 관계 선택 프로세스

    실제로 프로젝트를 전개할 때 식별자 관계와 비식별자 관계를 취사선택하여 연결하는 내공은 높은 수준의 데이터모델링 기술이다.

    식별자 관계에서 비식별자 관계를 파악하는 기술이 필요한데 다음 흐름에 따라 비식별자 관계를 선정하면 합리적으로 관계를 설정할 수 있다. 기본적으로 식별자 관계로 모든 관계가 연결되면서 다음 조건에 해당할 경우 비식별자 관계로 조정하면 된다.

    1. 관계의 강/약 분석: 약한 관계일 경우
    2. 자식테이블 독립 PK 필요: 독립 PK 구성
    3. SQL 복잡도 증가, 개발 생산성 저하: PK 속성 단순화

  - 식별자와 비식별자관계 비교

    | 항목               | 식별자 관계                                                  | 비식별자 관계                                                |
    | ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
    | 목적               | 강한 연결관계 표현                                           | 약한 연결관계 표현                                           |
    | 자식 주식별자 영향 | 자식 주식별자의 구성에 포함됨                                | 자식 일반 속성에 포함됨                                      |
    | 표기법             | 실선                                                         | 점선                                                         |
    | 연결 고려사항      | - 반드시 부모엔터티 종속 <br> - 자식 주식별자 구성에 부모 주식별자 포함 필요 <br> - 상속받은 주식별자 속성을 타 엔터티에 이전 필요 | - 약한 종속 관계 <br> - 자식 주식별자 구성을 독립적으로 구성 <br> - 자식 주식별자 구성에 부모 주식별자 부분 필요 <br> - 상속받은 주식별자 속성을 타 엔터티에 차단 필요 <br> - 부모쪽의 관계참여가 선택관계 |





## Ref.
- SQL 전문가 가이드 2013 Edition